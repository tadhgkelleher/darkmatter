<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Galaxy in Brane-World Gravity with Dark Matter</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
            color: #333;
        }
        h1, h2 {
            text-align: center;
        }
        #visualization {
            display: block;
            margin: 0 auto;
            border: 2px solid #333;
            background-color: #000;
        }
        #controls {
            text-align: center;
            margin-top: 20px;
        }
        button, input, label {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
        }
        .mathjax {
            max-width: 800px;
            margin: 10px auto;
            line-height: 1.6;
        }
        p {
            max-width: 800px;
            margin: 10px auto;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <h1>3D Galaxy in Brane-World Gravity with Dark Matter</h1>
    <canvas id="visualization" width="800" height="600"></canvas>
    <div id="controls">
        <button onclick="toggleDarkMatter()">Toggle Dark Matter Halo</button>
        <label for="kkModes">KK Modes (n): </label>
        <input type="range" id="kkModes" min="1" max="5" step="1" value="3">
        <label for="compactLength">Compactification Length (L): </label>
        <input type="range" id="compactLength" min="1" max="10" step="1" value="5">
        <label for="weylStrength">Weyl Tensor Strength: </label>
        <input type="range" id="weylStrength" min="0.1" max="2" step="0.1" value="1">
    </div>
    <h2>Mathematical Framework</h2>
    <div class="mathjax">
        <p>5D Einstein Equations: \( G_{AB}^{(5)} = \kappa_5^2 \left[ T_{AB}^{(\text{bulk})} + \delta(y) T_{\mu\nu}^{(\text{brane})} \right] \)</p>
        <p>Dark Matter Scalar Field: \( \phi(x^\mu, y) = \sum_{n=0}^\infty \phi_n(x^\mu) \cos\left(\frac{n\pi y}{L}\right) \)</p>
        <p>Induced 4D Gravity: \( G_{\mu\nu}^{(4)} = 8\pi G_N T_{\mu\nu}^{(\text{vis})} + \kappa_5^4 \Pi_{\mu\nu} - E_{\mu\nu} \)</p>
    </div>
    <h2>Explanation</h2>
    <p>
        This visualization shows a spiral galaxy on a 4D brane (blue disk with white stars) at \( y = 0 \) in a 5D bulk. The dark matter scalar field \( \phi(x^\mu, y) \) is represented by colored particles in the bulk, with color indicating field strength (blue = low, white = medium, red = high) and depth suggesting the extra dimension (fainter particles are farther in \( y \)). Red radial lines on the galaxy depict gravitational perturbations from the Weyl tensor \( E_{\mu\nu} \). Use the controls to adjust parameters and explore the model.
    </p>

    <script>
        const canvas = document.getElementById('visualization');
        const ctx = canvas.getContext('2d');
        let showDarkMatter = true;
        let kkModes = 3;
        let compactLength = 5;
        let weylStrength = 1;
        let time = 0;

        // Galaxy stars
        const stars = [];
        for (let i = 0; i < 200; i++) {
            let r = Math.random() * 200;
            let theta = Math.random() * 2 * Math.PI;
            let arm = Math.floor(Math.random() * 2) * Math.PI;
            theta += 0.5 * r + arm;
            stars.push({ r, theta });
        }

        // Dark matter particles
        const N_particles = 500;
        const particles = [];
        for (let i = 0; i < N_particles; i++) {
            let x = (Math.random() - 0.5) * 800; // [-400,400]
            let z = (Math.random() - 0.5) * 800; // [-400,400]
            let y = Math.random() * 100; // [0,100]
            particles.push({ x, y, z });
        }

        function toggleDarkMatter() {
            showDarkMatter = !showDarkMatter;
            draw();
        }

        document.getElementById('kkModes').addEventListener('input', (e) => {
            kkModes = parseInt(e.target.value);
            draw();
        });

        document.getElementById('compactLength').addEventListener('input', (e) => {
            compactLength = parseFloat(e.target.value);
            draw();
        });

        document.getElementById('weylStrength').addEventListener('input', (e) => {
            weylStrength = parseFloat(e.target.value);
            draw();
        });

        function drawBulk() {
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 1;
            for (let x = 0; x <= canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y <= canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            ctx.fillStyle = '#fff';
            ctx.font = '16px Arial';
            ctx.fillText('5D Bulk', 10, 30);
        }

        function drawDarkMatterParticles() {
            if (!showDarkMatter) return;
            const L = compactLength * 10; // L from 10 to 100
            const max_phi = 3;
            particles.forEach(p => {
                let phi = 0;
                for (let n = 1; n <= kkModes; n++) {
                    let a_n = 1 / n;
                    let k_n = n * 0.01;
                    let omega_n = n * 0.1;
                    let phi_n = a_n * Math.sin(k_n * p.x + omega_n * time);
                    let y_comp = Math.cos(n * Math.PI * p.y / L);
                    phi += phi_n * y_comp;
                }
                let phi_norm = Math.max(-1, Math.min(1, phi / max_phi));
                let normalized_phi = (phi_norm + 1) / 2;
                let r, g, b;
                if (normalized_phi < 0.5) {
                    let t = 2 * normalized_phi;
                    r = 255 * t;
                    g = 255 * t;
                    b = 255;
                } else {
                    let t = 2 * (normalized_phi - 0.5);
                    r = 255;
                    g = 255 * (1 - t);
                    b = 255 * (1 - t);
                }
                let alpha = 1 - p.y / L;
                let canvas_x = 400 + p.x;
                let canvas_y = 300 + p.z + 0.2 * p.y;
                let size = 2 * (1 - p.y / L);
                ctx.beginPath();
                ctx.arc(canvas_x, canvas_y, size, 0, 2 * Math.PI);
                ctx.fillStyle = `rgba(${r},${g},${b},${alpha})`;
                ctx.fill();
            });
        }

        function drawGalaxy() {
            // Draw galactic disk
            ctx.fillStyle = 'rgba(0, 0, 255, 0.2)';
            ctx.beginPath();
            ctx.arc(400, 300, 200, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#00f';
            ctx.lineWidth = 2;
            ctx.stroke();
            // Draw stars
            ctx.fillStyle = '#fff';
            stars.forEach(star => {
                let x = 400 + star.r * Math.cos(star.theta + time * 0.05);
                let y = 300 + star.r * Math.sin(star.theta + time * 0.05);
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, 2 * Math.PI);
                ctx.fill();
            });
        }

        function drawGravitationalEffects() {
            ctx.strokeStyle = '#f00';
            ctx.lineWidth = 2;
            for (let theta = 0; theta < 2 * Math.PI; theta += Math.PI / 4) {
                let amplitude = weylStrength * 20 * Math.sin(time + theta);
                let x1 = 400 + 180 * Math.cos(theta);
                let y1 = 300 + 180 * Math.sin(theta);
                let x2 = 400 + (180 + amplitude) * Math.cos(theta);
                let y2 = 300 + (180 + amplitude) * Math.sin(theta);
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBulk();
            drawDarkMatterParticles();
            drawGalaxy();
            drawGravitationalEffects();
        }

        function animate() {
            time += 0.05;
            draw();
            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
